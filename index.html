<!DOCTYPE html>
<html>
<head>
  <title>AquelARde</title>

  <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body style="margin:0; overflow:hidden;">

<!-- Pantalla de desbloqueo de audio -->
<div id="tapToStart"
     style="
       position: fixed;
       top: 0;
       left: 0;
       width: 100vw;
       height: 100vh;
       background: rgba(0,0,0,0.9);
       color: white;
       display: flex;
       align-items: center;
       justify-content: center;
       z-index: 999;
       font-family: sans-serif;
       text-align: center;
       font-size: 24px;
       cursor: pointer;">
  Toca para invocar el ritual ðŸ”¥
</div>

<a-scene
  mindar-image="imageTargetSrc: marker.mind;"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false">

  <a-assets>
    <img id="fuegoImg" src="fire.webp">
    <audio id="musicaRitual" src="ritual.mp3" preload="auto"></audio>
  </a-assets>

  <a-camera position="0 0 0" look-controls="enabled:false"></a-camera>

  <!-- Target de la pintura -->
  <a-entity id="target" mindar-image-target="targetIndex: 0">

    <!-- FUEGO -->
    <a-plane
      src="#fuegoImg"
      material="transparent: true; shader: flat; side: double; alphaTest: 0.5"
      position="0 0 0.1"
      width="1.3"
      height="1.3"

      animation__flicker="
        property: scale;
        to: 0.9 1.4 1;
        dir: alternate;
        dur: 400;
        loop: true;
        easing: easeInOutSine"

      animation__float="
        property: position;
        to: 0 0.05 0.1;
        dir: alternate;
        dur: 900;
        loop: true;
        easing: easeInOutQuad">
    </a-plane>

  </a-entity>

</a-scene>

<script>
  const overlay = document.getElementById("tapToStart");
  const target = document.getElementById("target");
  const audio = document.getElementById("musicaRitual");

  let audioUnlocked = false;

  // Crear contexto de audio real (necesario para mÃ³viles)
  const AudioContext = window.AudioContext || window.webkitAudioContext;
  const audioContext = new AudioContext();
  const source = audioContext.createMediaElementSource(audio);
  source.connect(audioContext.destination);

  // Desbloqueo por toque
  overlay.addEventListener("click", async () => {
    await audioContext.resume();
    audio.play();
    audio.pause();
    audio.currentTime = 0;

    audioUnlocked = true;
    overlay.style.display = "none";

    console.log("Audio desbloqueado");
  });

  // Cuando la pintura aparece
  target.addEventListener("targetFound", () => {
    if (!audioUnlocked) return;
    console.log("Pintura detectada â€“ ritual activo");
    audio.play();
  });

  // Cuando se pierde la pintura
  target.addEventListener("targetLost", () => {
    if (!audioUnlocked) return;
    console.log("Pintura perdida â€“ silencio");
    audio.pause();
  });
</script>

</body>
</html>
